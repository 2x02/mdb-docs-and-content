<!--Section: Docs content-->
<section>
  <!--Section: Introduction-->
  <section id="section-introduction">
    <!-- Main title -->
    <h2 class="h1 font-weight-bold" style="line-height: 0.8">
      <?= $data_var['main_title']; ?>
    </h2>

    <!-- Seo title -->
    <h1 class="h6"><?= $data_var['seo_title']; ?></h1>

    <!-- Description -->
    <p class="description"><?= $data_var['description']; ?></p>

    <p class="note note-success">
      For creating Contact Forms using <strong>PHP</strong> environment please follow the
      <a href="#" target="_blank">link</a>
    </p>
  </section>
  <!--Section: Introduction-->

  <hr class="my-5" />

  <!--Section: Form HTML-->
  <section id="section-form-html">
    <!-- Section title -->
    <h2 class="mb-4">Form HTML</h2>

    <!-- description -->
    <p class="mb-4">
      First, create basic contact form which will be our base for validating and sending data.
    </p>

    <p class="note note-danger">
      Within this tutorial we are using the Material Design for Bootstrap library, you can download
      it for free from
      <a href="https://mdbootstrap.com/docs/standard/getting-started/installation/"
        ><strong>here</strong></a
      >. Without the library, the form will still work â€” however it may look and behave differently.
      It's recommended to use this library along with the tutorial.
    </p>

    <!--Section: Live Preview-->
    <section class="border p-4 d-flex justify-content-center mb-4">
      <form id="form" class="text-center" style="width: 100%; max-width: 300px">
        <h2>Contact us</h2>

        <!-- Name input -->
        <div class="form-outline mb-4">
          <input type="text" id="name" name="name" class="form-control" />
          <label class="form-label" for="name">Name</label>
        </div>

        <!-- Email input -->
        <div class="form-outline mb-4">
          <input type="email" id="email" name="email" class="form-control" />
          <label class="form-label" for="email">Email address</label>
        </div>

        <!-- Subject input -->
        <div class="form-outline mb-4">
          <input type="text" id="subject" name="subject" class="form-control" />
          <label class="form-label" for="subject">Subject</label>
        </div>

        <!-- Message input -->
        <div class="form-outline mb-4">
          <textarea class="form-control" id="message" name="message" rows="4"></textarea>
          <label class="form-label" for="message">Message</label>
        </div>

        <!-- Submit button -->
        <button class="btn btn-primary btn-block mb-4">Send</button>
      </form>
    </section>
    <!--Section: Live Preview-->

    <p class="mt-4">
      Copy and paste the following HTML and JavaScript code into your file (e.g.
      <code>index.html</code>):
    </p>

    <!--Section: Code-->
    <section class="mb-4">
      <!-- prettier-ignore -->
      <mdbsnippet>
        <code data-lang="html" data-name="HTML">
          <form id="contact-form">
            <h2>Contact us</h2>

            <!-- Name input -->
            <div class="form-outline mb-4">
              <input type="text" id="name" name="name" class="form-control" />
              <label class="form-label" for="name">Name</label>
            </div>

            <!-- Email input -->
            <div class="form-outline mb-4">
              <input type="email" id="email" name="email" class="form-control" />
              <label class="form-label" for="email">Email address</label>
            </div>

            <!-- Subject input -->
            <div class="form-outline mb-4">
              <input type="text" id="subject" name="subject" class="form-control" />
              <label class="form-label" for="subject">Subject</label>
            </div>

            <!-- Message input -->
            <div class="form-outline mb-4">
              <textarea class="form-control" id="message" name="message" rows="4"></textarea>
              <label class="form-label" for="message">Message</label>
            </div>

            <div class="form-check">
              <input type="checkbox" class="form-check-input" name="mailCopy" id="mailCopy" value="1">
              <label for="mailCopy" class="form-check-label">Notify me about new updates</label>
            </div>

            <!-- Submit button -->
            <button id="submit-form" type="submit" class="btn btn-primary btn-block mb-4">
              Send
            </button>
          </form>
        </code>
      </mdbsnippet>
    </section>
    <!--Section: Code-->

    <p class="note note-warning">
      Rest of the frontend code for sending Contact Forms with NodeJS will be the same as in
      <strong><a href="" target="_blank">PHP Contact Form</a></strong> tutorial, therefore it won't
      be biscussed in more detail here and only parts of it requiring minor changes will be shown.
    </p>
  </section>
  <!--Section: Form HTML-->

  <hr class="my-5" />

  <!--Section: Node server -->
  <section id="section-node-server">
    <!-- Section title -->
    <h2 class="mb-4">Create NodeJS server file</h2>

    <!-- description -->
    <p class="mb-4">
      Create a new file called <code>server.js</code> inside your application's root directory.
    </p>

    <p class="mb-4">
      If you haven't installed the express, nodemailer and body-parser packages from the npm
      repository so far, do so immediately using the following command in your application terminal:
    </p>
    <section class="mb-4">
      <mdbsnippet class="mb-4">
        <code data-lang="js" data-name="JavaScript">
          npm install express nodemailer body-parser dotenv express-validator --save
        </code>
      </mdbsnippet>
    </section>

    <p class="mb-4">
      Having all set up, let's create our server. Paste following code into your file
    </p>

    <!--Section: Code-->
    <section class="mb-4">
      <!-- prettier-ignore -->
      <mdbsnippet>
        <code data-lang="js" data-name="JavaScript">
          const express = require('express');
          const nodemailer = require('nodemailer');

          const app = express();
          const port = process.env.PORT || 3000;

          const bodyParser = require('body-parser');

          app.use(bodyParser.json());

          app.listen(port, () => {
          console.log('Express started on port: ', port);
          });

        </code>
      </mdbsnippet>
    </section>
    <!--Section: Code-->

    <p>
      This will import all necessary dependencies, initialize application as expressinstance, create
      body-parser middleware that will extract the eniter body from the request and expose it to the
      server, and finally start the server.
    </p>
  </section>
  <!--Section: Node server -->

  <hr class="my-5" />

  <!--Section: File structure -->
  <section id="section-file-structure">
    <!-- Section title -->
    <h2 class="mb-4">Create file structure for mail sending</h2>

    <!-- description -->
    <p class="mb-4">
      Having the server set up you are ready to create a file structure for mail sending route and
      middleware. For the purposes of our course, it is not necessary, but in case you want to
      expand the functionality of our example, it is worth knowing what the file structure could
      looks like in applications using the NodeJS environment and Express server.
    </p>

    <!--Section: Environment variables -->
    <section id="subsection-environment-variables" class="mb-4">
      <!-- Section title -->
      <h4 class="mb-4">Create and read environment variables file</h4>

      <p>
        Firstly, create <code>.env</code> file inside your root directory. This file will contain
        all your private data that is used inside your NodeJS project. It's content for our purposes
        would look like this:
      </p>

      <!--Section: Code-->
      <section class="mb-4">
        <mdbsnippet class="mb-4">
          <code data-lang="js" data-name="JavaScript">
            PORT=3000 MAIL_USERNAME=your_email_address_here MAIL_PASSWORD=your_email_password
            MAIL_HOST=smtp.gmail.com MAIL_PORT=465 MAIL_PROVIDER=gmail
          </code>
        </mdbsnippet>
      </section>
      <!--Section: Code-->

      <p class="mb-4">
        Please note that we are using SMTP for Gmail here. If you would like to use another provider
        your <code>HOST, PORT and PROVIDER</code> would be different. Also if you would like to send
        test mails in development mode you may want to be interested in fake SMTP servers, e.g.
        <a href="https://mailtrap.io/" target="_blank">Mailtrap</a>.
      </p>

      <p class="note note-danger mb-4">
        <strong>Never</strong> publish your environment variable files. Include all your
        <code>.env</code> files inside <code>.gitignore</code> file when you publish your code.
      </p>

      <p>
        Now add <code>/config/index.js</code> file that will read all your environment variables.
      </p>

      <!--Section: Code-->
      <section class="mb-4">
        <mdbsnippet class="mb-4">
          <code data-lang="js" data-name="JavaScript">
            require('dotenv').config(); module.exports = { PORT: process.env.PORT || 3000,
            MAIL_HOST: process.env.MAIL_HOST, MAIL_PORT: process.env.MAIL_PORT, MAIL_PROVIDER:
            process.env.MAIL_PROVIDER, MAIL_USERNAME: process.env.MAIL_USERNAME, MAIL_PASSWORDD:
            process.env.MAIL_PASSWORD, };
          </code>
        </mdbsnippet>
      </section>
      <!--Section: Code-->

      <p class="mb-4">
        ... and change your <code>server.js</code> file so the config can expose your variables to
        the server:
      </p>

      <!--Section: Code-->
      <section class="mb-4">
        <mdbsnippet class="mb-4">
          <code data-lang="js" data-name="JavaScript">
            const express = require('express'); const bodyParser = require('body-parser'); const
            config = require('./config'); const app = express(); app.use(bodyParser.json());
            app.use(require('./routes')); app.listen(config.PORT, () => { console.log(`Server is
            running on port ${config.PORT}.`); });
          </code>
        </mdbsnippet>
      </section>
      <!--Section: Code-->

      <p>
        Also notice that we added <code>app.use(require('./routes'));</code> which will use our
        router from the next section.
      </p>
    </section>
    <!--Section: Environment variables -->

    <!--Section: Router -->
    <section id="subsection-router" class="mb-4">
      <!-- Section title -->
      <h4 class="mb-4">Create router and contact form routes.</h4>

      <p class="mb-4">
        Create <code>/routes</code> folder and inside it create two files. First
        <code>index.js</code> that will control all your project routes:
      </p>

      <!--Section: Code-->
      <section class="mb-4">
        <mdbsnippet class="mb-4">
          <code data-lang="js" data-name="JavaScript">
            const express = require('express'); const router = express.Router({ mergeParams: true
            }); router.use('/contact', require('./contact.routes')); module.exports = router;
          </code>
        </mdbsnippet>
      </section>
      <!--Section: Code-->

      <p class="mb-4">
        ... and <code>contact.routes.js</code> file that will contain all your contact form related
        routes.
      </p>

      <!--Section: Code-->
      <section class="mb-4">
        <mdbsnippet class="mb-4">
          <code data-lang="js" data-name="JavaScript">
            // express server specific imports const express = require('express'); const router =
            express.Router({ mergeParams: true }); // import for cotact form routes controller const
            contactController = require('../controllers/contact.controller'); // import for contact
            validation middleware const { contactValidation } =
            require('../middlewares/contactValidation'); router.post('/', contactValidation(),
            contactController.sendContactForm); module.exports = router;
          </code>
        </mdbsnippet>
      </section>
      <!--Section: Code-->

      <p class="mb-4">
        Thanks to <code>express.Router({ mergeParams: true })</code> we can access the
        <code>params</code> from the parent router inside the child router. In our case creating
        <code>router.post('/', ...)</code> is equal to <code>router.post('/contact', ...)</code>.
        This structure is very helpful in deep nested routes structure.
      </p>

      <p class="mb-4">
        Our contact router is also using <code>sendContactForm</code> method from the
        contactController. Let's create this file.
      </p>
    </section>
    <!--Section: Router -->

    <!--Section: Contact controller -->
    <section id="subsection-contact-controller" class="mb-4">
      <!-- Section title -->
      <h4 class="mb-4">Contact controller</h4>

      <p class="mb-4">
        Controllers are callback functions passed to the router methods which process request to the
        route and generate the response.
      </p>

      <p class="mb-4">Controller for <code>/contact</code> route will look as follows:</p>

      <!--Section: Code-->
      <section class="mb-4">
        <mdbsnippet class="mb-4">
          <code data-lang="js" data-name="JavaScript">
            const nodemailer = require('nodemailer'); const { check, validationResult } =
            require('express-validator'); const { MAIL_HOST, MAIL_PORT, MAIL_PROVIDER,
            MAIL_USERNAME, MAIL_PASSWORD } = require('../config'); const transporter =
            nodemailer.createTransport({ host: MAIL_HOST, provider: MAIL_PROVIDER, port: MAIL_PORT,
            secure: true, auth: { user: MAIL_USERNAME, pass: MAIL_PASSWORD, }, tls: {
            rejectUnauthorized: false, }, }); exports.sendContactForm = async (req, res) => { await
            check('name').notEmpty().withMessage('You must supply a name').run(req); await
            check('email').isEmail().normalizeEmail().withMessage('Email is not valid').run(req);
            await check('subject').notEmpty().withMessage('You must supply a subject').run(req);
            await check('message').notEmpty().withMessage('You must supply a subject').run(req);
            await check('mailCopy').toBoolean().run(req); const errors = validationResult(req); if
            (!errors.isEmpty()) { return res.status(400).json({ errors: errors.array() }); } const {
            name, email, subject, message, mailCopy } = req.body; const mailOptions = { to: [''], //
            Enter here the email address on which you want to send emails from your customers from:
            name, subject, text: message, replyTo: email, }; if (mailCopy) {
            mailOptions.to.push(email); } transporter .sendMail(message) .then(() => { return
            res.status(200).json({ msg: 'Email sent successfully' }); }) .catch((error) => { return
            res.status(400).json({ msg: `Something went wront: ${error}` }); }); };
          </code>
        </mdbsnippet>
      </section>
      <!--Section: Code-->

      <p>
        Line 5 - <code>const transporter = nodemailer.createTransport({ })</code> is used to create
        a function that takes the object containing the configuration of the transporter as a
        parameter. It is in this configuration that you define the host from which emails are sent,
        the provider (if it is gmail), port, authorization, and many other things that are to be
        sent.
      </p>

      <p>
        Lines 20-24 - since manual validation of the contact form in the NodeJS environment would
        look very similar to the validation on the <a href="" target="_blank">frontend</a> site,
        we've decided to validate our backend code with <code>express-validator</code> package. Its
        documentation can be found
        <a href="https://express-validator.github.io/docs/" target="_blank">here</a>.
      </p>

      <p>Lines 26-29 - server response with error message for negativley validated contact form.</p>

      <p>
        Lines 33-43 - defines the <code>mailOptions</code> object that is sent to the sendMail()
        method. It is in this object that we define, to who the email is to be sent, from who, what
        is its subject, text, and to who the response in the email is to be addressed. In this
        object are many more options that you can use. You will find them
        <a gref="https://nodemailer.com/message/" target="_blank">here</a>.
      </p>

      <p>
        Lines 45-52 - Code responsible for sending the mail with the parameters defined inside
        <code>mailOptions</code>. Will send either success or failure response message to the
        frontend.
      </p>
    </section>
    <!--Section: Contact controller -->
  </section>
  <!--Section: File structure -->
</section>
<!--Section: Docs content-->
